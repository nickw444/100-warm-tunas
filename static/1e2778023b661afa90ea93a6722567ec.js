!function(){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var d=function(){function n(e){var t=this;a(this,n),this.el=e,this.events=new Map,this.el.onended=function(){var e=t.events.get(n.Event.ENDED);e&&e()},this.el.onpause=function(){var e=t.events.get(n.Event.PAUSED);e&&e()},this.el.onplay=function(){var e=t.events.get(n.Event.RESUMED);e&&e()}}return e(n,[{key:"play",value:function(e){document.body.classList.add("hasPlayer"),this.el.classList.remove("hidden"),this.el.setAttribute("src",e),this.el.play()}},{key:"hide",value:function(){this.el.classList.add("hidden")}},{key:"on",value:function(e,t){this.events.set(e,t)}}]),n}();d.Event={ENDED:1,PAUSED:2,RESUMED:3};var v=function(){function r(e,t,n){var i=this;a(this,r),this.playerView=t,this.analytics=e,this.activeResult=null,this.resultListView=n,this.playerView.on(d.Event.ENDED,function(){return i.onPlaybackEnded()}),this.playerView.on(d.Event.RESUMED,function(){return i.onPlaybackResumed()}),this.playerView.on(d.Event.PAUSED,function(){return i.onPlaybackPaused()}),this.resultListView.onListenClick(function(e){return i.play(e)})}return e(r,[{key:"play",value:function(e){this.activeResult&&this.activeResult.el===e.el||(null!=this.activeResult&&this.activeResult.stopPlaying(),(this.activeResult=e).play(),this.playerView.play(e.getPreviewSrc()),this.analytics.trackPlayEvent(e.getPreviewSrc(),e.getSongId(),"".concat(e.getTitle()," - ").concat(e.getArtistName()),e.getRank()))}},{key:"playAudio",value:function(){var e=document.getElementById("player");e.classList.remove("hidden"),document.body.classList.add("hasPlayer"),e.setAttribute("src",src),e.play(),e.onended=function(){return e.classList.add("hidden")}}},{key:"onPlaybackEnded",value:function(){null!=this.activeResult&&(this.activeResult.stopPlaying(),this.playerView.hide(),this.activeResult=null)}},{key:"onPlaybackPaused",value:function(){null!=this.activeResult&&this.activeResult.pause()}},{key:"onPlaybackResumed",value:function(){null!=this.activeResult&&this.activeResult.resume()}}]),r}(),r=function(){function t(e){a(this,t),this.el=e,this.artworkEl=this.el.querySelector(".result__artwork")}return e(t,[{key:"getRank",value:function(){return this.el.querySelector(".result__rank").innerText}},{key:"getTitle",value:function(){return this.el.querySelector(".result__trackTitle").innerText}},{key:"getArtistName",value:function(){return this.el.querySelector(".result__artistName").innerText}},{key:"getPreviewSrc",value:function(){return this.el.dataset.previewSrc}},{key:"getSongId",value:function(){return this.el.dataset.songId}},{key:"play",value:function(){var e=this;this.artworkEl.classList.add("result__artwork--prePlay"),window.setTimeout(function(){e.artworkEl.classList.add("result__artwork--playing")},300)}},{key:"pause",value:function(){this.artworkEl.classList.add("result__artwork--paused")}},{key:"resume",value:function(){this.artworkEl.classList.remove("result__artwork--paused")}},{key:"stopPlaying",value:function(){var e=this;this.artworkEl.classList.add("result__artwork--fadeout"),window.setTimeout(function(){window.requestAnimationFrame(function(){e.artworkEl.classList.remove("result__artwork--prePlay","result__artwork--playing"),window.requestAnimationFrame(function(){e.artworkEl.classList.remove("result__artwork--fadeout")})})},350)}}],[{key:"of",value:function(e){return new t(e)}}]),t}(),f=function(){function n(e){var t=this;a(this,n),this.el=e,this.onListenClickCb=null,this.el.addEventListener("click",function(e){return t.onClick(e)})}return e(n,[{key:"onClick",value:function(e){e.target;var t=s(e.target,this.el,function(e){return e.classList.contains("result__artworkPlayButton")||e.classList.contains("result__listenButton")});if(t){var n=s(t,this.el,function(e){return e.classList.contains("result")}),i=new r(n);this.onListenClickCb&&this.onListenClickCb(i)}}},{key:"handleListenClick",value:function(e){var t=r.of(e);return this.onListenClickCb&&this.onListenClickCb(t)}},{key:"onListenClick",value:function(e){this.onListenClickCb=e}}]),n}();function s(e,t,n){for(var i=e;i!=t;){if(n(i))return i;i=i.parentNode}}var h=function(){function t(e){a(this,t),this.gaMeasurementId=e}return e(t,[{key:"trackPlayEvent",value:function(e,t,n,i){gtag("event","play",{send_to:this.gaMeasurementId,event_category:"listen",event_action:"click",previewSrc:e,songId:t,songTitle:n,resultCurrentRank:i})}}]),t}();function y(){var i=document.querySelector(".header__spotify");if(null!=i){var r=new IntersectionObserver(function(e){var t,n;e[0].isIntersecting&&(t=i,(n=document.createElement("iframe")).src=t.dataset.spotifyEmbedUrl,n.width=n.height=300,n.classList.add("header__spotifyEmbed"),n.title="Spotify Embed",n.onload=function(){n.classList.add("header__spotifyEmbed--loaded")},t.appendChild(n),r.disconnect())});r.observe(i)}}var k=window.requestIdleCallback||function(e){return window.setTimeout(e,50)};document.addEventListener("DOMContentLoaded",function(){var e,t,n,r,a,i,s,l=window.bootstrap,o=l.gaMeasurementId,u=l.particlesJsConfig,c=new h(o);e=c,t=new f(document.querySelector(".countdown ul")),n=new d(document.getElementById("player")),new v(e,n,t),r=new Set,a=new Set,i=new IntersectionObserver(function(e){e.forEach(function(t){var n=t.target.dataset.src,i=t.target.dataset.alt;if(t.isIntersecting){if(r.has(n))return;r.add(n),t.target.classList.add("result__artworkPlaceholder--loading"),window.setTimeout(function(){if(r.has(n)){if(a.has(n))return;a.add(n);var e=new Image;e.src=n,e.alt=i,e.classList.add("result__artworkImage","result__artworkImage--fadein"),e.onload=function(){t.target.parentNode.insertBefore(e,t.target),t.target.remove()},e.onerror=function(){t.target.classList.remove("result__artworkPlaceholder--loading")}}},200)}else r.delete(n)})},{rootMargin:"48px"}),document.querySelectorAll(".result__artworkPlaceholder").forEach(function(e){return i.observe(e)}),y(),u&&(s=u,k(function(){return particlesJS.load("particles-js",s)}))})}();
