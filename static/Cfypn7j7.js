!function(){"use strict";class e{constructor(e){this.gaMeasurementId=e}trackPlayEvent(e,t,s,i){gtag("event","play",{send_to:this.gaMeasurementId,event_category:"listen",event_action:"click",previewSrc:e,songId:t,songTitle:s,resultCurrentRank:i})}trackControlsButtonVisibleEvent(){gtag("event","controls_button_visible",{event_category:"controls"})}trackControlsOpenEvent(){gtag("event","controls_open",{event_category:"controls"})}trackControlsChangedEvent(e){gtag("event","controls_changed",{event_category:"controls",event_label:e.join(", ")})}trackDonationDialogShowEvent(){gtag("event","donation_dialog_show",{event_category:"donation_dialog"})}trackDonationDialogClickEvent(e){gtag("event","donation_dialog_click",{event_category:"donation_dialog",event_action:"donation_dialog_click_"+e})}}class t{static requiredString(e,t){return s.checkExists(e[t])}static optionalString(e,t){return e[t]}static requiredObject(e,t,i){return e(s.checkExists(t[i]))}static optionalBoolean(e,t){return e[t]}static requiredBoolean(e,s){return t.optionalBoolean(e,s)||!1}}class s{static checkExists(e){if(null==e)throw new Error("expected value");return e}}const i=window.requestIdleCallback||(e=>window.setTimeout(e,50));class n extends Error{}class o extends n{}class r extends n{}class a extends r{}class l extends r{}class c extends r{}class d{async get(e,t){const s=await fetch(e,{...t,credentials:"include"});return await this.handleStatus(s),await s.json()}async post(e,t){const s=await fetch(e,{...t,method:"POST",credentials:"include"});return await this.handleStatus(s),await s.json()}async handleStatus(e){if(e.status>=200&&e.status<300)return;let t="";if("application/json"===e.headers.get("Content-Type"))try{t=(await e.json()).detail}catch(e){}switch(e.status){case 400:throw new a(t||"Error: "+e.statusText);case 403:throw new l(t||"Error: "+e.statusText);case 404:throw new c(t||"Error: "+e.statusText)}throw e.status>=400&&e.status<500?new r(t||"Error: "+e.statusText):e.status>=500&&e.status<600?new o(t||"Error: "+e.statusText):e.status<200||e.status>=300?new n(t||"Error: "+e.statusText):new Error("Unhandled network error")}}class u{constructor(e,t,s,i,n,o,r){this.controlsView=e,this.controlsButtonView=t,this.maskView=s,this.resultListPresenter=i,this.resultsService=n,this.analytics=o,this.resultsUrlSlug=r,this.hasTrackedControlsButtonVisible=!1,this.prevMediaTypes=[],e.on(1,(e=>this.onSelectedMediaTypesChange(e))),t.on(1,(()=>this.onToggle(!this.controlsView.isOpen()))),s.on(1,(()=>this.onToggle(!1))),this.prevMediaTypes=this.controlsView.getAllMediaTypes()}attach(){this.resultListPresenter.onVisibilityChange((e=>{this.controlsButtonView.toggleVisibility(e),e&&!this.hasTrackedControlsButtonVisible&&(this.analytics.trackControlsButtonVisibleEvent(),this.hasTrackedControlsButtonVisible=!0)}))}async onSelectedMediaTypesChange(e){if(0===e.length)return i((()=>this.analytics.trackControlsChangedEvent([]))),this.resultListPresenter.setResults([]),this.resultListPresenter.setStatus("No media types selected. Please select at least one media type."),void(this.pendingRequest=void 0);const t=this.controlsView.getAllMediaTypes().filter((e=>!["modelled","exclude_placed"].includes(e))),s=e.filter((e=>!["modelled","exclude_placed"].includes(e)));!this.prevMediaTypes.includes("modelled")&&e.includes("modelled")?t.forEach((e=>{this.controlsView.setMediaTypeSelected(e,!0)})):t.length!=s.length&&e.includes("modelled")&&this.controlsView.setMediaTypeSelected("modelled",!1),e=this.controlsView.getSelectedMediaTypes(),this.prevMediaTypes=e,this.resultListPresenter.setLoading(!0),this.resultListPresenter.setResults([]);const n=this.pendingRequest=(o=500,new Promise((e=>{window.setTimeout((()=>e(void 0)),o)}))).then((()=>{if(n!==this.pendingRequest)throw new h})).then((()=>(i((()=>this.analytics.trackControlsChangedEvent([...e].sort()))),this.resultsService.getResults(e)))).then((e=>{if(n!==this.pendingRequest)throw new h;this.resultListPresenter.setLoading(!1),this.resultListPresenter.setResults(e.results0100.map((t=>({isMega:t.isMega,backgroundColor:t.backgroundColor,previewUrl:t.previewUrl,songId:t.songId,position:t.position,songTitle:t.songTitle,artistName:t.artistName,numVotes:t.numVotes,votePercentage:Math.floor(t.numVotes/e.numEntries*100),artworkUrl:`/static/artwork/${this.resultsUrlSlug}/`+t.artworkFilename,modelApplied:t.modelApplied,rankOrig:t.rankOrig,numVotesOrig:t.numVotesOrig}))))})).catch((e=>{if(!(e instanceof h))throw this.resultListPresenter.setStatus("An error occurred whilst fetching data. Please try again."),e}));var o}onToggle(e){e&&this.analytics.trackControlsOpenEvent(),this.maskView.toggle(e),this.controlsView.toggle(e),this.controlsButtonView.toggle(e)}}class h extends Error{}class g{constructor(e){this.el=e,this.eventHandlers={}}getElement(){return this.el}trigger(e,...t){const s=this.eventHandlers[e];s&&s(...t)}on(e,t){this.eventHandlers[e]=t}}function p(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}class m extends g{constructor(e){super(e),this.mediaTypesFormEl=s.checkExists(e.querySelector(".controls__form--mediaTypes")),this.mediaTypesFormEl.addEventListener("change",(()=>this.trigger(1,this.getSelectedMediaTypes())))}static render(e,t,s){const i=p(`<div class="controls controls--hidden">\n  <div class="container container--narrow">\n    <h3>Included Media Types</h3>\n    <p>Fine-tune the prediction by selecting the specific media types to be counted.</p>\n    <form class="controls__form controls__form--mediaTypes">\n      ${s?'<div style="padding-bottom: 8px; margin-bottom:8px; border-bottom:1px solid #eee;"><label><input value="modelled" type="checkbox" checked autocomplete="off"> Enable ML Model 🔮✨ (experimental, <a href="/news/2023/01/ml-model-result-adjustment/" target="_blank">learn more</a>)</label></div>':""}\n      ${t?'<div><label><input value="exclude_placed" type="checkbox" checked autocomplete="off"> Eliminate songs that have placed in the Hottest 200-101</label></div>':""}\n      <div><label><input value="instagram_post" type="checkbox" checked autocomplete="off"> Instagram Posts <span class="controls__formMeta">(${e.instagramPost} entries)</span></label>\n      </div>\n      <div><label><input value="instagram_direct_message" type="checkbox" checked autocomplete="off"> Instagram DMs <span class="controls__formMeta">(${e.instagramDirectMessage} entries)</span></label>\n      </div>\n      ${e.instagramStory?`<div><label><input value="instagram_story" type="checkbox" checked autocomplete="off"> Instagram Stories <span class="controls__formMeta">(${e.instagramStory} entries)</span></label></div>`:""}\n      ${e.twitterPost?`<div><label><input value="twitter_post" type="checkbox" checked autocomplete="off"> Twitter Posts <span class="controls__formMeta">(${e.twitterPost}  entries)</span></label></div>`:""}\n      <div><label><input value="reddit_comment" type="checkbox" checked autocomplete="off"> Reddit Comments <span class="controls__formMeta">(${e.redditComment}  entries)</span></label>\n      </div>\n      ${null!=e.webUpload?`<div><label><input value="web_upload" type="checkbox" checked autocomplete="off"> Website Uploads <span class="controls__formMeta">(${e.webUpload}  entries)</span></label></div>`:""}\n    </form>\n  </div>\n</div>\n`);return new m(i)}toggle(e){e?this.el.classList.remove("controls--hidden"):this.el.classList.add("controls--hidden")}isOpen(){return!this.el.classList.contains("controls--hidden")}getSelectedMediaTypes(){const e=[];return this.mediaTypesFormEl.querySelectorAll('input[type="checkbox"]').forEach((t=>{t.checked&&e.push(t.value)})),e}getAllMediaTypes(){const e=[];return this.mediaTypesFormEl.querySelectorAll('input[type="checkbox"]').forEach((t=>e.push(t.value))),e}setMediaTypeSelected(e,t){s.checkExists(this.mediaTypesFormEl.querySelector(`input[type="checkbox"][value="${e}"]`)).checked=t}}class w extends g{constructor(e){super(e),e.addEventListener("click",(()=>this.trigger(1)))}static render(){const e=p('<div class="controls__buttonContainer controls__buttonContainer--hidden">\n  <button class="controls__button">\n    <span class="controls__icon icon-equalizer"></span>\n    <span class="controls__icon controls__icon--hidden icon-close"></span>\n  </button>\n</div>');return new w(e)}toggleVisibility(e){e?this.el.classList.remove("controls__buttonContainer--hidden"):this.el.classList.add("controls__buttonContainer--hidden")}toggle(e){const t=s.checkExists(this.el.querySelector(".controls__icon.icon-equalizer")),i=s.checkExists(this.el.querySelector(".controls__icon.icon-close"));e?(t.classList.add("controls__icon--hidden"),i.classList.remove("controls__icon--hidden")):(t.classList.remove("controls__icon--hidden"),i.classList.add("controls__icon--hidden"))}}class v extends g{constructor(e){super(e),e.addEventListener("click",(()=>this.trigger(1)))}static render(){const e=p('<div class="controls__mask controls__mask--hidden"></div>');return new v(e)}toggle(e){e?(this.el.classList.remove("controls__mask--hidden"),document.body.classList.add("noscroll")):(this.el.classList.add("controls__mask--hidden"),document.body.classList.remove("noscroll"))}}const y="100wt-donation-diag",k=6048e5,_=17063136e5;function b(e){if(!function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}())return;if(Date.now()>17069184e5)return;const t=window.localStorage.getItem(y);if(null!=t&&parseInt(t)>Date.now())return;const i=45+Math.round(30*Math.random());window.setTimeout((()=>function(e){const t=document.createElement("div");function i(){document.body.classList.remove("noscroll"),t.classList.remove("dialog--visible"),window.setTimeout((()=>{t.remove()}),200)}t.classList.add("dialog"),t.innerHTML='\n    <div class="dialog__content">\n       <img class="dialog__heroImg" src="/static/client/coffeecup.svg" alt="" /> \n       <h2>Enjoying The Predictions?&nbsp;🔥</h2>\n       <p>100 Warm Tunas involves a handful of server and 3rd party vendor costs, so a\n       small contribution will help to keep 100 Warm Tunas running for years to come.</p>\n       <p>You can show your support by buying me a coffee&nbsp;☕️</p>\n       <div>\n       <a href="https://www.buymeacoffee.com/nickw444" target="_blank" rel="noreferrer nofollow" class="dialog__cta dialog__cta--brand" id="buyCoffeeCta">\n          Buy me a coffee&nbsp;☕️\n       </a>\n      <button href="#" class="dialog__cta" id="noThanksCta">\n        No thanks\n      </button>\n      </div>\n    </div>\n  ',s.checkExists(t.querySelector("#noThanksCta")).addEventListener("click",(t=>{e.trackDonationDialogClickEvent("no_thanks"),i(),E()})),s.checkExists(t.querySelector("#buyCoffeeCta")).addEventListener("click",(t=>{e.trackDonationDialogClickEvent("buy_coffee"),i(),E()}));const n=s.checkExists(t.querySelector(".dialog__content"));let o=0;t.addEventListener("click",(t=>{const s=n.getBoundingClientRect();(t.clientY<s.top||t.clientY>s.bottom||t.clientX<s.left||t.clientX>s.right)&&(o++,o>1&&(e.trackDonationDialogClickEvent("backdrop"),i(),E()))})),document.body.appendChild(t),document.body.classList.add("noscroll"),window.requestAnimationFrame((()=>{t.classList.add("dialog--visible"),e.trackDonationDialogShowEvent()}))}(e)),1e3*i)}function E(){localStorage.setItem(y,String(function(){const e=Date.now();return e<_?Math.min(e+k,_):e+k}()))}class f extends g{constructor(e){super(e),this.navListEl=s.checkExists(this.el.querySelector(".header__navList")),this.maskEl=s.checkExists(this.el.querySelector(".header__navListMask"));const t=s.checkExists(this.el.querySelector(".header__hamburgerButton")),i=s.checkExists(this.el.querySelector(".header__navListClose"));t.addEventListener("click",(()=>this.trigger(1))),[this.maskEl,i].forEach((e=>e.addEventListener("click",(()=>this.trigger(2)))))}toggleHamburger(e){this.toggle(this.navListEl,e,"header__navList--visible"),this.toggle(this.maskEl,e,"header__navListMask--visible")}toggle(e,t,s){t?e.classList.add(s):e.classList.remove(s)}}function S(){!function(){let e;window.addEventListener("resize",(()=>{document.body.classList.add("resizing"),window.clearTimeout(e),e=window.setTimeout((()=>document.body.classList.remove("resizing")),200)}))}();const e=s.checkExists(document.querySelector(".header")),t=new f(e);t.on(1,(()=>{document.body.classList.add("noscroll"),t.toggleHamburger(!0)})),t.on(2,(()=>{document.body.classList.remove("noscroll"),t.toggleHamburger(!1)}))}const L="scrollBehavior"in document.documentElement.style?window.scrollTo:({top:e})=>{let t=window.scrollY;const s=e-t,i=Date.now();!function e(){window.requestAnimationFrame((()=>{const n=Date.now()-i,o=Math.max(Math.min(n/300,1),0),r=(a=o)<.5?2*a*a:(4-2*a)*a-1;var a;const l=t+r*s;window.scrollTo(window.scrollX,l),o<1&&e()}))}()};console.log();class T{constructor({gaMeasurementId:e,resultsUrlSlug:t,enableExcludePlacedControl:s,enableModelControl:i}){this.gaMeasurementId=e,this.resultsUrlSlug=t,this.enableExcludePlacedControl=s,this.enableModelControl=i}static deserialize(e){return new T({gaMeasurementId:t.requiredString(e,"gaMeasurementId"),resultsUrlSlug:t.optionalString(e,"resultsUrlSlug"),enableExcludePlacedControl:t.requiredBoolean(e,"enableExcludePlacedControl"),enableModelControl:t.requiredBoolean(e,"enableModelControl")})}}class C{constructor(e,t,i){this.analytics=e,this.playerView=t,this.resultListView=i,this.playerState=1,this.activeResult=void 0,this.playerView.on(1,(()=>this.onPlaybackEnded())),this.playerView.on(3,(()=>this.onPlaybackResumed())),this.playerView.on(2,(()=>this.onPlaybackPaused())),this.playerView.on(4,(()=>this.handleListenClick(s.checkExists(this.activeResult),!0))),this.playerView.on(6,(e=>this.playerView.setProgressIndicator(e))),this.playerView.on(5,(e=>this.playerView.setPlaybackProgress(e))),this.resultListView.on(1,this.handleListenClick.bind(this))}handleListenClick(e,t){if(this.activeResult&&this.activeResult.equals(e))switch(this.playerState){case 3:return this.resume();case 2:return t&&this.pause();default:return}this.play(e)}play(e){if(this.activeResult&&this.activeResult.equals(e))return;this.playerState=2,null!=this.activeResult&&this.activeResult.stopPlaying(),this.activeResult=e,e.play();const{artworkSrc:t,previewSrc:s,artist:i,rank:n,songId:o,title:r}=e.getSongInfo();this.playerView.setSrc(s),this.playerView.setProgressIndicator(0),this.playerView.play(),this.playerView.setInfo({artworkSrc:t,title:r,artist:i}),this.playerView.show(),this.analytics.trackPlayEvent(s,o,`${r} - ${i}`,n)}pause(){this.playerState=3,this.playerView.pause()}resume(){this.playerState=2,this.playerView.play()}onPlaybackEnded(){null!=this.activeResult&&(this.playerState=1,this.activeResult.stopPlaying(),this.playerView.hide(),this.activeResult=void 0)}onPlaybackPaused(){null!=this.activeResult&&(this.playerState=3,this.activeResult.pause())}onPlaybackResumed(){null!=this.activeResult&&(this.playerState=2,this.activeResult.resume())}}function P(e){return e.touches.length>0?e.touches[0]:void 0}class x extends g{constructor(e){super(e),this.artworkEl=void 0,this.isDragging=!1,this.audioEl=s.checkExists(e.querySelector("audio")),this.artworkPlayIconEl=s.checkExists(this.el.querySelector(".player__artworkPlayButton span")),this.progressIndicatorEl=s.checkExists(this.el.querySelector(".player__progressIndicator")),this.audioEl.onended=()=>this.trigger(1),this.audioEl.onpause=()=>this.trigger(2),this.audioEl.onplay=()=>this.trigger(3),this.audioEl.ontimeupdate=()=>!this.isDragging&&this.trigger(6,this.audioEl.currentTime/this.audioEl.duration);s.checkExists(this.el.querySelector(".player__artworkPlayButton")).addEventListener("click",(()=>this.trigger(4))),this.progressBarEl=s.checkExists(this.el.querySelector(".player__progress")),this.progressBarEl.addEventListener("mousedown",(e=>0===e.button&&this.onProgressMouseDown(e))),this.progressBarEl.addEventListener("touchstart",(e=>this.onProgressMouseDown(P(e))),{passive:!0}),this.progressIndicatorEl.addEventListener("mousedown",(e=>0===e.button&&this.onProgressMouseDown(e))),this.progressIndicatorEl.addEventListener("touchstart",(e=>this.onProgressMouseDown(P(e))),{passive:!0}),window.addEventListener("mousemove",(e=>this.onMouseMove(e))),window.addEventListener("touchmove",(e=>this.onMouseMove(P(e))),{passive:!0}),window.addEventListener("mouseup",(e=>this.onMouseUp(e))),window.addEventListener("touchend",(e=>this.onMouseUp(P(e))),{passive:!0})}onProgressMouseDown(e){document.body.classList.add("dragging"),this.isDragging=!0,this.lastDragPosition=this.getPlaybackPositionOfClientX(s.checkExists(e))}onMouseMove(e){this.isDragging&&(this.lastDragPosition=this.getPlaybackPositionOfClientX(s.checkExists(e)),this.setProgressIndicator(this.lastDragPosition))}onMouseUp(e){if(!this.isDragging)return;document.body.classList.remove("dragging"),this.isDragging=!1;const t=null!=e?this.getPlaybackPositionOfClientX(e):this.lastDragPosition;this.lastDragPosition=void 0,this.trigger(5,s.checkExists(t))}setSrc(e){this.audioEl.setAttribute("src",e)}setInfo({artworkSrc:e,title:t,artist:i}){this.artworkEl||(this.artworkEl=document.createElement("img"),this.artworkEl.className="player__artworkImage",s.checkExists(this.el.querySelector(".player__artwork")).appendChild(this.artworkEl)),e?this.artworkEl.src=e:(this.artworkEl.remove(),this.artworkEl=void 0),s.checkExists(this.el.querySelector(".player__title")).innerText=t,s.checkExists(this.el.querySelector(".player__artist")).innerText=i}pause(){this.artworkPlayIconEl.className="icon-play2",this.audioEl.pause()}play(){this.artworkPlayIconEl.className="icon-pause",this.audioEl.play()}show(){this.el.classList.remove("player--hidden"),document.body.classList.add("hasPlayer")}hide(){this.el.classList.add("player--hidden"),document.body.classList.remove("hasPlayer")}setPlaybackProgress(e){this.audioEl.currentTime=e*this.audioEl.duration}setProgressIndicator(e){const t=-12*e-12;this.progressIndicatorEl.style.transform=`translateX(calc(${t}px + ${100*e}%)`}getPlaybackPositionOfClientX(e){const{left:t,width:s}=this.progressBarEl.getBoundingClientRect(),i=(e.clientX-(t+6))/(s-12);return Math.max(Math.min(i,1),0)}}class M{constructor(e,t){this.id=e,this.accessToken=t}static deserialize(e){return{id:e.id,accessToken:e.accessToken}}}class I{constructor(e,t,s){this.id=e,this.state=t,this.matchedVotes=s}static deserialize(e){return{id:e.id,state:e.state,matchedVotes:e.matchedVotes}}}class V{constructor(e,t,s,i,n,o,r){this.id=e,this.title=t,this.artistName=s,this.previewUrl=i,this.artworkUrl=n,this.artworkUrlLarge=o,this.artworkDominantColor=r}static deserialize(e){return new V(e.id,e.title,e.artistName,e.previewUrl,e.artworkUrl,e.artworkUrlLarge,e.artworkDominantColor)}}class q{constructor(e,t,s,i,n,o,r,a){this.songId=e,this.song=t,this.position=s,this.positionOrig=i,this.positionUpper=n,this.positionLower=o,this.voteCount=r,this.voteCountScaled=a}static deserialize(e){return new q(e.songId,V.deserialize(e.song),e.position,e.positionOrig,e.positionUpper,e.positionLower,e.voteCount,e.voteCountScaled)}}class A{constructor(e,t,s,i){this.results=e,this.numEntries=t,this.numVotes=s,this.lastUpdated=i}static deserialize(e){return{results:e.results.map(q.deserialize),numEntries:e.numEntries,numVotes:e.numVotes,lastUpdated:e.lastUpdated}}}class U{constructor(e,t){this.submissionId=e,this.accessToken=t}}class ${constructor(e,t){this.httpService=e,this.apiBaseUrl=t}async createSubmission(e){const t=new FormData;t.append("file",e.file),t.append("challengeToken",e.challengeToken),t.append("challengeType",e.challengeType);const s=await this.httpService.post(`${this.apiBaseUrl}/api/submission/`,{body:t,headers:void 0});return M.deserialize(s)}async getSubmissionStatus(e){const t=await this.httpService.get(`${this.apiBaseUrl}/api/submission/${e.submissionId}`,{headers:{"Content-Type":"application/json","X-Access-Token":e.accessToken}});return I.deserialize(t)}async postExchangeToken(e){return await this.httpService.post(`${this.apiBaseUrl}/api/submission/${e.submissionId}/exchange`,{headers:{"Content-Type":"application/json","X-Access-Token":e.accessToken}}),{}}async getPredictionCurrent(){const e=await this.httpService.get(`${this.apiBaseUrl}/api/prediction/current?fetchSongs=true`);return A.deserialize(e)}}class D{constructor(e){this.view=e,this.pendingAssetTimers=new Map,this.loadingAssets=new Set,e.on(2,this.onArtworkVisibilityChange.bind(this))}setLoading(e){this.view.getStatusView().setLoading(e)}setStatus(e){this.view.getStatusView().setText(e)}setResults(e){this.view.setResults(e),this.pendingAssetTimers.clear(),this.loadingAssets.clear()}onVisibilityChange(e){this.view.attachListIntersectionObserver(),this.view.on(3,e)}onArtworkVisibilityChange(e,t,s,i,n){if(t){if(this.pendingAssetTimers.has(s))return;e.setArtworkLoading();const t=window.setTimeout((()=>{this.loadingAssets.has(s)||(this.loadingAssets.add(s),e.loadArtwork(s,i),n())}),200);this.pendingAssetTimers.set(s,t)}else window.clearInterval(this.pendingAssetTimers.get(s)),this.pendingAssetTimers.delete(s)}}class B{constructor(e){this.el=e,this.artworkPlayIconEl=this.el.querySelector(".result__artworkPlayButton span"),this.artworkEl=s.checkExists(this.el.querySelector(".result__artwork"))}static render(e){const t=p(O(e));return new B(t)}getElement(){return this.el}equals(e){return this.el===e.el}getSongInfo(){return{rank:this.el.querySelector(".result__rank").textContent,artworkSrc:this.getArtworkSrc(),songId:t.requiredString(this.el.dataset,"songId"),previewSrc:t.requiredString(this.el.dataset,"previewSrc"),artist:this.el.querySelector(".result__artistName").textContent,title:this.el.querySelector(".result__trackTitle").textContent}}getArtworkSrc(){const e=this.el.querySelector(".result__artworkImage"),s=this.el.querySelector(".result__artworkPlaceholder");return null!=e?e.src:s?t.requiredString(s.dataset,"src"):void 0}play(){this.artworkEl.classList.add("result__artwork--prePlay"),this.setPlayIconCls("icon-pause"),window.setTimeout((()=>{this.artworkEl.classList.add("result__artwork--playing")}),300)}pause(){this.artworkEl.classList.add("result__artwork--paused"),this.setPlayIconCls("icon-play2")}resume(){this.artworkEl.classList.remove("result__artwork--paused"),this.setPlayIconCls("icon-pause")}stopPlaying(){this.artworkEl.classList.add("result__artwork--fadeout"),this.setPlayIconCls("icon-play2"),window.setTimeout((()=>{window.requestAnimationFrame((()=>{this.artworkEl.classList.remove("result__artwork--prePlay","result__artwork--playing"),window.requestAnimationFrame((()=>{this.artworkEl.classList.remove("result__artwork--fadeout")}))}))}),350)}setArtworkLoading(){s.checkExists(this.el.querySelector(".result__artworkPlaceholder")).classList.add("result__artworkPlaceholder--loading")}loadArtwork(e,t){const i=s.checkExists(this.el.querySelector(".result__artworkPlaceholder")),n=new Image;n.src=e,n.alt=t,n.classList.add("result__artworkImage","result__artworkImage--fadein"),n.onload=()=>{i.parentNode.insertBefore(n,i),i.remove()},n.onerror=()=>{i.classList.remove("result__artworkPlaceholder--loading")}}setPlayIconCls(e){this.artworkPlayIconEl&&(this.artworkPlayIconEl.className=e)}}const O=e=>`<li class="result${e.isMega?" result--mega":""}"\n      style="${e.isMega?`background: #${e.backgroundColor} radial-gradient(circle, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 100%)`:""}"\n      data-preview-src="${e.previewUrl}"\n      data-song-id="${e.songId}"\n      >\n        <div class="container container--narrow">\n          <div class="result__content">\n            <div class="result__rankContainer">\n              <div class="result__rank">${e.position}</div>\n            </div>\n            <div class="result__details">\n              <div class="result__trackTitle">${e.songTitle}</div>\n              <div class="result__artistName">${e.artistName}</div>\n              <div class="result__voteDetails">${e.numVotesOrig||e.numVotes}\n                votes (${e.votePercentage}%)\n                ${e.previewUrl?'\n                    &nbsp;&nbsp;|&nbsp;&nbsp;\n                    <button class="result__listenButton">\n                      <span class="icon-play2"></span>&nbsp;Listen\n                    </button>\n                ':""}\n                ${!e.isMega&&e.modelApplied?`\n                  &nbsp;&nbsp;|&nbsp;&nbsp;✨ ML Model Applied (was #${e.rankOrig})\n                `:""}\n              </div>\n              ${e.isMega&&e.modelApplied?`\n                <div class="result__voteBounds">\n                  ✨ ML Model Applied (was #${e.rankOrig})\n                </div>\n              `:""}\n            </div>\n            <div class="result__artwork">\n                ${e.artworkUrl?`\n                <div class="result__artworkSpinner">\n                    <div class="result__artworkPlaceholder"\n                         data-alt="Cover artwork for ${e.songTitle} - ${e.artistName}"\n                         data-src="${e.artworkUrl}"></div>\n                  </div>\n                  ${e.previewUrl?`\n                  <button class="result__artworkPlayButton"\n                            aria-label="Play ${e.songTitle} by ${e.artistName}">\n                      <span class="icon-play2"></span>\n                    </button>\n                  `:""}\n                `:""}\n            </div>\n          </div>\n        </div>\n      </li>\n`;class R{constructor(e){this.el=e}getElement(){return this.el}static render(){const e=document.createElement("div");return e.className="countdown__statusIndicator countdown__statusIndicator--hidden",new R(e)}setLoading(e){e?(this.setVisible(!0),this.el.innerHTML='<div class="countdown__statusIcon"><span class="icon-spinner"></span></div>'):this.setVisible(!1)}setText(e){if(!e)return void this.setVisible(!1);this.setVisible(!0);const t=document.createElement("div");t.className="countdown__statusMessage",t.innerText=e,this.el.innerHTML="",this.el.appendChild(t)}setVisible(e){e?this.el.classList.remove("countdown__statusIndicator--hidden"):this.el.classList.add("countdown__statusIndicator--hidden")}}class z extends g{constructor(e){super(e),this.listEl=s.checkExists(this.el.querySelector(".countdown__list"))}attach(){this.el.addEventListener("click",(e=>this.onClick(e))),this.observeLazyArtwork()}getStatusView(){return this.statusView||(this.statusView=R.render(),this.el.insertBefore(this.statusView.getElement(),this.listEl)),this.statusView}setResults(e){this.listEl.innerHTML="";for(const t of e){const e=B.render(t);this.listEl.appendChild(e.getElement())}this.observeLazyArtwork()}setFootnote(e){null==this.footnoteContainerEl&&(this.footnoteContainerEl=document.createElement("div"),this.footnoteContainerEl.classList.add("container","container--narrow","countdown__footnote"),this.el.appendChild(this.footnoteContainerEl)),this.footnoteContainerEl.innerHTML="",this.footnoteContainerEl.appendChild(e)}attachListIntersectionObserver(){new IntersectionObserver((e=>{e.length&&this.trigger(3,e[0].isIntersecting)}),{rootMargin:"-96px 0px"}).observe(this.listEl)}onClick(e){const t=N(e.target,this.el,"result__artworkPlayButton"),s=N(e.target,this.el,"result__listenButton"),i=t||s;if(i){const e=H(i,this.el);this.trigger(1,e,i===t)}}observeLazyArtwork(){const e=this.getOrCreateArtworkObserver();this.el.querySelectorAll(".result__artworkPlaceholder").forEach((t=>e.observe(t)))}getOrCreateArtworkObserver(){return this.artworkObserver||(this.artworkObserver=new IntersectionObserver((e=>this.onArtworkObservationChange(s.checkExists(this.artworkObserver),e)))),this.artworkObserver}onArtworkObservationChange(e,s){s.forEach((s=>{const i=s.target,n=H(i,this.el),o=t.requiredString(i.dataset,"src"),r=t.requiredString(i.dataset,"alt");this.trigger(2,n,s.isIntersecting,o,r,(()=>e.unobserve(i)))}))}}function H(e,t){const i=s.checkExists(N(e,t,"result"));return new B(i)}function N(e,t,s){let i=e;for(;i&&i!==t;){if(i.classList.contains(s))return i;i=i.parentNode}}async function F(e,t,s,i){const n=null==t;let o;function r(e){n?o&&(o.style.display=e?"block":"none"):s&&s.setLoading(e)}try{r(!0);a(await i.getPredictionCurrent())}catch(t){if(t instanceof l){e.innerHTML="";const{uploaderEl:t,loaderEl:s}=function(){const e=document.createElement("div"),t=document.createElement("p");t.innerHTML=n?"Help us make a more accurate prediction 🔥. Submit your votes by uploading them below:":"<strong>Want a sneak peek?</strong> Upload a screenshot of your votes to take a look:";e.appendChild(t);const s=document.createElement("form");s.classList.add("votesUploaderForm"),e.appendChild(s);const o=document.createElement("label");o.setAttribute("for","fileInput"),o.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>\n    <span>Choose a file…</span>\n',s.appendChild(o);const c=document.createElement("input");function d(){const e=c.files?.item(0);null!=e&&async function({file:e,setError:t,setHidden:s,resetForm:n}){let o,c;t(void 0),s(!0),r(!0);try{await new Promise((e=>{grecaptcha.ready((()=>{e(void 0)}))})),o=await grecaptcha.execute("6LeHL6sqAAAAAAnMIVlU7vd47NGdl6iCpPFVfh0a",{action:"submit"})}catch(e){throw t("Something went wrong whilst verifying your browser session. Please try again later."),s(!1),r(!1),n(),e}try{c=await i.createSubmission({file:e,challengeToken:o,challengeType:"grecaptcha_v3"})}catch(e){throw t(e instanceof l?"Something went wrong whilst verifying your submission. Please try again.":"Something went wrong whilst processing your image. Please try again later."),s(!1),r(!1),n(),e}let d;try{d=await async function({submissionId:e,accessToken:t}){let s;const n=Date.now();do{if(null!=s&&await j(1e3),Date.now()-n>3e4)return"timeout";s=await i.getSubmissionStatus({submissionId:e,accessToken:t})}while("processed"!=s.state);if(0==s.matchedVotes.length)return"novotes";return}({submissionId:c.id,accessToken:c.accessToken})}catch(e){throw s(!1),t("Something went wrong whilst processing your image. Please try again later."),r(!1),n(),e}if(null!=d){switch(d){case"novotes":s(!1),t("We did not detect any valid votes in the image you uploaded. Please ensure you are uploading a screenshot of your vote confirmation from triple j.");break;case"timeout":s(!1),t("Something went wrong whilst processing your image. Please try again later.")}return r(!1),void n()}try{await async function({submissionId:e,accessToken:t}){await i.postExchangeToken(new U(e,t))}({submissionId:c.id,accessToken:c.accessToken})}catch(e){throw s(!1),t("Something went wrong whilst processing your image. Please try again later."),r(!1),n(),e}try{a(await i.getPredictionCurrent())}catch(e){throw t("Something went wrong whilst processing your image. Please try again later."),e}finally{s(!1),r(!1),n()}}({file:e,setHidden:m,setError:p,resetForm:u})}function u(){c.value=""}c.type="file",c.name="upload",c.accept="image/*",c.id="fileInput",s.appendChild(c),c.addEventListener("change",(e=>d()));let h;n&&(h=document.createElement("div"),h.classList.add("loader"),h.innerHTML='<span class="countdown__statusIcon icon-spinner"></span>',h.style.display="none",e.appendChild(h));const g=document.createElement("div");g.classList.add("votesUploaderFormError"),e.appendChild(g);const p=e=>{if(e){const t=document.createElement("p");t.innerText=e,g.appendChild(t)}else g.innerHTML=""};if(n){const t=document.createElement("p");t.innerHTML='You can also submit your votes by sending a screenshot of your votes as a direct message to\n<a target="_blank" rel="noreferrer nofollow" class="hero__link"\n   href="https://www.instagram.com/100warmtunas/">@100warmtunas</a>\non Instagram.',e.appendChild(t)}const m=e=>{e?s.classList.add("votesUploaderForm--hidden"):s.classList.remove("votesUploaderForm--hidden")};return{uploaderEl:e,loaderEl:h}}();return o=s,void e.appendChild(t)}throw t}finally{r(!1)}async function a(i){const o=i.results.length;if(n||!(o>0))return void(e.innerHTML="Thanks for submitting your votes. This helps us build a more accurate prediction 🐟");e.innerHTML=`<strong>Thanks for submitting your votes</strong>. Here is your sneak peek of the top ${o}:`,s&&s.setResults(i.results.sort(((e,t)=>t.position-e.position)).map((e=>{if(null==e.song)throw new Error("Song is not hydrated.");return{isMega:o>10&&e.position<=10,backgroundColor:e.song.artworkDominantColor,previewUrl:e.song.previewUrl,songId:0,position:e.position,songTitle:e.song.title,artistName:e.song.artistName,numVotes:e.voteCount,votePercentage:Math.round(e.voteCount/i.numEntries*100),artworkUrl:e.song.artworkUrl,modelApplied:!1,rankOrig:void 0,numVotesOrig:void 0}})));const r=document.createElement("p");let a="";if(null!=i.lastUpdated){const e={hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short"};a=`Data was last processed at ${new Date(1e3*i.lastUpdated).toLocaleString(void 0,e)}. `}r.innerText=`${a}Data is based on ${i.numVotes} votes counted across ${i.numEntries} entries.`,t&&t.setFootnote(r)}}function j(e){return new Promise((t=>{setTimeout((()=>t(void 0)),e)}))}const X={deserialize:e=>({position:e.position,isMega:e.is_mega,songId:e.song_id,songTitle:e.song_title,artistName:e.artist_name,previewUrl:e.preview_url,numVotes:e.num_votes,artworkFilename:e.artwork_filename,backgroundColor:e.background_color,modelApplied:e.model_applied,numVotesOrig:e.num_votes_orig,rankOrig:e.rank_orig})},Y={deserialize:e=>({numEntries:e.num_entries,numVotes:e.num_votes,numPreviousYearVotes:e.numPreviousYearVotes,lastProcessedTs:e.last_processed_ts,results0100:e.results_0_100.map(X.deserialize)})},W={deserialize:e=>({instagramPost:e.instagram_post,instagramDirectMessage:e.instagram_direct_message,instagramStory:e.instagram_story,twitterPost:e.twitter_post,redditComment:e.reddit_comment,webUpload:e.web_upload})};class G{constructor(e,t){this.httpService=e,this.resultsUrlSlug=t}async getResults(e){const t=[...e].sort(),s=`/static/results/${this.resultsUrlSlug}/`+t.join("+")+".json",i=await this.httpService.get(s);return Y.deserialize(i)}async getEntryCountBySource(){const e=`/static/results/${this.resultsUrlSlug}/entryCountsBySource.json`,t=await this.httpService.get(e);return W.deserialize(t)}}function Z(){const e=document.querySelector(".header__spotify");if(null==e)return;const s=new IntersectionObserver((n=>{n[0].isIntersecting&&(i((()=>function(e){const s=document.createElement("iframe");s.src=t.requiredString(e.dataset,"spotifyEmbedUrl"),s.width=s.height="300px",s.classList.add("header__spotifyEmbed"),s.title="Spotify Embed",s.onload=()=>{s.classList.add("header__spotifyEmbed--loaded")},e.appendChild(s)}(e))),s.disconnect())}));s.observe(e)}document.addEventListener("DOMContentLoaded",(function(){const{gaMeasurementId:n,resultsUrlSlug:o,enableExcludePlacedControl:r,enableModelControl:a}=t.requiredObject(T.deserialize,window,"bootstrap"),l=new e(n),h=document.querySelector(".countdown"),g=document.querySelector(".uploader"),p=document.querySelector(".uploaderRoot--installGa"),y=new d,k=new $(y,window.location.href.includes("localhost")?"http://localhost:8000":"https://api.100warmtunas.com");if(p&&(p.classList.add("uploader","uploader--ga"),F(p,void 0,void 0,k)),null!=h){const{resultListView:e,resultListPresenter:t}=function(e){const t=new z(e);return{resultListView:t,resultListPresenter:new D(t)}}(h);!function(e,t){const i=new x(s.checkExists(document.querySelector(".player")));new C(e,i,t)}(l,e),b(l),e.attach(),null!=g&&F(g,e,t,k),i((()=>{if(o){!async function(e,t,i,n,o,r,a){let l;try{l=await e.getEntryCountBySource()}catch(e){if(e instanceof c)return;return void console.error(e)}const d=w.render(),h=v.render(),g=m.render(l,o,r),p=s.checkExists(i.parentNode);p.insertBefore(d.getElement(),i),p.insertBefore(h.getElement(),i),p.insertBefore(g.getElement(),i),new u(g,d,h,n,e,t,a).attach()}(new G(y,o),l,h,t,r,a,o)}}))}Z(),S(),function(){const e=document.querySelector(".hero__viewCountdownCta"),t=document.querySelector(".countdown");e&&t&&e.addEventListener("click",(()=>{L({top:t.offsetTop-32,behavior:"smooth"})}))}(),"Australia/Sydney"!==Intl.DateTimeFormat().resolvedOptions().timeZone&&document.querySelectorAll(".localTime").forEach((e=>{const s=parseInt(t.requiredString(e.dataset,"ts"),10),i=new Date(1e3*s).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short"});e.innerText=`(${i} in your time zone)`}))}))}();
//# sourceMappingURL=Cfypn7j7.js.map
